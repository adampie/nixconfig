[tasks.update]
run = "ulimit -n unlimited && nix flake update"

[tasks.fmt]
run = "nix fmt ."

[tasks.check]
run = "nix flake check --all-systems"

[tasks.plan]
run = """
ulimit -n unlimited
darwin-rebuild build --flake .#
nix store diff-closures /run/current-system ./result
read -p "Apply these changes? [y/N] " confirm
[ "$confirm" = "y" ] || [ "$confirm" = "Y" ] || exit 1
"""

[tasks.apply]
run = """
ulimit -n unlimited
sudo darwin-rebuild switch --flake .#
if [ "$(git diff --name-only)" = "flake.lock" ]; then
  git add flake.lock && git commit -m "Nix flake update" && git push
fi
"""
